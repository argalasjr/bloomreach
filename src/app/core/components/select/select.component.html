<div [class]="cssClass()">
  <ng-select
    [ngModel]="value()"
    (ngModelChange)="value.set($event)"
    [items]="displayItems()"
    [bindLabel]="bindLabel()"
    [bindValue]="bindValue()"
    [placeholder]="placeholder()"
    [fixedPlaceholder]="false"
    [multiple]="multiple()"
    [searchable]="searchable()"
    [clearable]="clearable()"
    [disabled]="disabled()"
    [loading]="loading()"
    [notFoundText]="notFoundText()"
    [addTagText]="addTagText()"
    [loadingText]="loadingText()"
    [closeOnSelect]="closeOnSelect()"
    [hideSelected]="hideSelected()"
    [maxSelectedItems]="maxSelectedItems()"
    [groupBy]="groupBy"
    [selectOnTab]="selectOnTab()"
    [dropdownPosition]="dropdownPosition()"
    [virtualScroll]="virtualScroll()"
    [addTag]="addTag()"
    [minTermLength]="minTermLength()"
    [typeToSearchText]="typeToSearchText()"
    [searchFn]="customSearchFn"
    [compareWith]="compareWith"
    (change)="onChange($event)"
    (open)="onOpen()"
    (close)="onClose()"
    (clear)="onClear()"
    (search)="onSearch($event)"
    (add)="onAdd($event)"
    (remove)="onRemove($event)"
  >
    <!-- Custom header template if provided -->
    @if (headerTemplate()) {
      <ng-template ng-header-tmp>
        <ng-container *ngTemplateOutlet="headerTemplate()!"></ng-container>
      </ng-template>
    }

    <!-- Tabs header if tabs are provided -->
    @if (hasTabs()) {
      <ng-template ng-header-tmp>
        <div class="app-select__tabs">
          @for (tab of tabs(); track tab.value; let i = $index) {
            <button
              type="button"
              class="app-select__tab"
              [class.app-select__tab--active]="activeTabIndex() === i"
              (click)="switchTab(i)"
            >
              {{ tab.label }}
            </button>
          }
        </div>
      </ng-template>
    }

    <!-- Default label template -->
    <ng-template ng-label-tmp let-item="item">
      <span class="app-select__label">{{ item[bindLabel()] }}</span>
    </ng-template>

    <!-- Default option template -->
    <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
      <div class="app-select__option">
        <span>{{ item[bindLabel()] }}</span>
      </div>
    </ng-template>

    <!-- Default multi-label template (optional) -->
    @if (multiple()) {
      <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
        <div class="app-select__multi-label">
          <span class="app-select__multi-count">{{ items.length }} selected</span>
          @if (clearable()) {
            <span class="app-select__multi-clear" (click)="clear()">Ã—</span>
          }
        </div>
      </ng-template>
    }
  </ng-select>
</div>
